# éƒ¨ç½²æ–¹å¼æ€»è§ˆ

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†åŸºäº Nginx Docker Compose çš„å¤šç§éƒ¨ç½²æ–¹å¼ï¼Œé€‚ç”¨äºä¸åŒçš„å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒéœ€æ±‚ã€‚

## ğŸ“‹ éƒ¨ç½²æ–¹å¼æ¦‚è§ˆ

æˆ‘ä»¬æä¾›äº† 4 ç§ä¸»è¦çš„éƒ¨ç½²æ–¹å¼ï¼Œæ»¡è¶³ä»å¼€å‘åˆ°ç”Ÿäº§çš„å„ç§åœºæ™¯éœ€æ±‚ï¼š

1. **æœ¬åœ°å•é¡¹ç›®éƒ¨ç½²** - é€‚åˆå¼€å‘æµ‹è¯•
2. **æœ¬åœ°å¤šé¡¹ç›®éƒ¨ç½²** - é€‚åˆç®¡ç†å¤šä¸ªå‰ç«¯åº”ç”¨
3. **è¿œç¨‹ä¸€é”®éƒ¨ç½²** - é€‚åˆå¿«é€Ÿéƒ¨ç½²åˆ°æœåŠ¡å™¨
4. **å…±äº«èµ„æºéƒ¨ç½²** - é€‚åˆç®¡ç†é€šç”¨é™æ€èµ„æº

---

## ğŸ”§ æ–¹å¼ä¸€ï¼šæœ¬åœ°ç®¡ç†éƒ¨ç½²

ä½¿ç”¨ `nginx-manager.sh` è„šæœ¬è¿›è¡Œæœ¬åœ°é¡¹ç›®ç®¡ç†å’Œéƒ¨ç½²ã€‚

### åŸºç¡€æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æœåŠ¡
./nginx-manager.sh start

# åœæ­¢æœåŠ¡
./nginx-manager.sh stop

# é‡å¯æœåŠ¡
./nginx-manager.sh restart

# æŸ¥çœ‹çŠ¶æ€
./nginx-manager.sh status

# æŸ¥çœ‹æ—¥å¿—
./nginx-manager.sh logs
```

### é¡¹ç›®éƒ¨ç½²

```bash
# éƒ¨ç½²å•ä¸ªé¡¹ç›®
./nginx-manager.sh deploy <é¡¹ç›®å> <æºç›®å½•>

# å®é™…ç¤ºä¾‹
./nginx-manager.sh deploy web /home/user/project/dist
./nginx-manager.sh deploy admin /home/user/admin/build
./nginx-manager.sh deploy mobile /home/user/mobile/dist
```

### é¡¹ç›®ç®¡ç†

```bash
# åˆ—å‡ºæ‰€æœ‰é¡¹ç›®
./nginx-manager.sh list

# åˆ é™¤é¡¹ç›®
./nginx-manager.sh remove <é¡¹ç›®å>

# å¤‡ä»½é¡¹ç›®
./nginx-manager.sh backup <é¡¹ç›®å>
```

### é…ç½®ç®¡ç†

```bash
# é‡æ–°åŠ è½½é…ç½®
./nginx-manager.sh reload

# æµ‹è¯•é…ç½®
./nginx-manager.sh test

# ç¼–è¾‘é…ç½®
./nginx-manager.sh edit
```

### âœ¨ ç‰¹ç‚¹
- âœ… æ”¯æŒå¤šé¡¹ç›®å¹¶è¡Œéƒ¨ç½²
- âœ… é¡¹ç›®å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å½±å“
- âœ… è®¿é—®è·¯å¾„ï¼š`http://localhost/<é¡¹ç›®å>/`
- âœ… æ”¯æŒé¡¹ç›®ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… è‡ªåŠ¨å¤‡ä»½æœºåˆ¶
- âœ… é…ç½®çƒ­é‡è½½

---

## ğŸŒ æ–¹å¼äºŒï¼šè¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²

ä½¿ç”¨ `remote-deploy.sh` è„šæœ¬è¿›è¡Œè¿œç¨‹æœåŠ¡å™¨è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚

### ä»…éƒ¨ç½²æ¡†æ¶

```bash
# éƒ¨ç½²åŸºç¡€æ¡†æ¶åˆ°æœåŠ¡å™¨
./scripts/remote-deploy.sh <æœåŠ¡å™¨IP> <ç”¨æˆ·å>

# ç¤ºä¾‹
./scripts/remote-deploy.sh 192.168.1.100 root
./scripts/remote-deploy.sh example.com ubuntu
```

### æ¡†æ¶+é¡¹ç›®ä¸€ä½“éƒ¨ç½²

```bash
# åŒæ—¶éƒ¨ç½²æ¡†æ¶å’Œå‰ç«¯é¡¹ç›®
./scripts/remote-deploy.sh <æœåŠ¡å™¨IP> <ç”¨æˆ·å> <é¡¹ç›®å> <æºç›®å½•>

# ç¤ºä¾‹
./scripts/remote-deploy.sh 192.168.1.100 root web /path/to/dist
./scripts/remote-deploy.sh example.com ubuntu admin /home/user/admin-dist
```

### åç»­é¡¹ç›®éƒ¨ç½²

```bash
# åœ¨å·²æœ‰æ¡†æ¶åŸºç¡€ä¸Šéƒ¨ç½²æ–°é¡¹ç›®
ssh root@192.168.1.100 'cd /opt/nginx-template && ./nginx-manager.sh deploy mobile /tmp/mobile-dist'
```

### âœ¨ ç‰¹ç‚¹
- âœ… ä¸€é”®è¿œç¨‹éƒ¨ç½²
- âœ… è‡ªåŠ¨ç¯å¢ƒæ£€æŸ¥ï¼ˆDockerã€Docker Composeï¼‰
- âœ… è‡ªåŠ¨é˜²ç«å¢™é…ç½®
- âœ… SSH è¿æ¥æµ‹è¯•
- âœ… éƒ¨ç½²çŠ¶æ€éªŒè¯
- âœ… é”™è¯¯å¤„ç†å’Œå›æ»š

---

## ğŸ“¦ æ–¹å¼ä¸‰ï¼šå…±äº«é™æ€èµ„æºéƒ¨ç½²

ä¸“é—¨ç”¨äºç®¡ç†åœ°å›¾ç“¦ç‰‡ã€é€šç”¨å›¾ç‰‡ã€å­—ä½“ç­‰å…±äº«èµ„æºã€‚

### åˆå§‹åŒ–å…±äº«èµ„æº

```bash
# åˆ›å»ºå…±äº«èµ„æºç›®å½•ç»“æ„
./nginx-manager.sh shared create
```

### ä¸Šä¼ èµ„æº

```bash
# ä¸Šä¼ åœ°å›¾ç“¦ç‰‡
./nginx-manager.sh shared upload /path/to/tiles tiles

# ä¸Šä¼ é€šç”¨å›¾ç‰‡
./nginx-manager.sh shared upload /path/to/images images

# ä¸Šä¼ å­—ä½“æ–‡ä»¶
./nginx-manager.sh shared upload /path/to/fonts fonts

# ä¸Šä¼ åœ°å›¾æ•°æ®
./nginx-manager.sh shared upload /path/to/maps maps

# ä¸Šä¼  JS åº“
./nginx-manager.sh shared upload /path/to/libs libs
```

### èµ„æºç®¡ç†

```bash
# æŸ¥çœ‹å…±äº«èµ„æºåˆ—è¡¨
./nginx-manager.sh shared list

# æŸ¥çœ‹å…±äº«èµ„æºä¿¡æ¯
./nginx-manager.sh shared info
```

### âœ¨ ç‰¹ç‚¹
- âœ… ç»Ÿä¸€ç®¡ç†é™æ€èµ„æº
- âœ… æ‰€æœ‰é¡¹ç›®å…±äº«è®¿é—®
- âœ… è®¿é—®è·¯å¾„ï¼š`http://localhost/shared/`
- âœ… æ”¯æŒå¤šç§èµ„æºç±»å‹
- âœ… ç›®å½•ç»“æ„æ ‡å‡†åŒ–

---

## ğŸ—‚ï¸ é¡¹ç›®ç›®å½•ç»“æ„

### å¤šé¡¹ç›®éƒ¨ç½²åçš„å®Œæ•´ç›®å½•ç»“æ„

```
nginx/html/
â”œâ”€â”€ shared/              # å…±äº«é™æ€èµ„æºç›®å½•
â”‚   â”œâ”€â”€ maps/           # åœ°å›¾æ•°æ®æ–‡ä»¶ (.json, .geojson)
â”‚   â”œâ”€â”€ tiles/          # åœ°å›¾ç“¦ç‰‡ ({z}/{x}/{y}.png)
â”‚   â”œâ”€â”€ images/         # é€šç”¨å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ fonts/          # å­—ä½“æ–‡ä»¶ (.woff2, .ttf)
â”‚   â”œâ”€â”€ icons/          # å›¾æ ‡æ–‡ä»¶
â”‚   â”œâ”€â”€ libs/           # å…±äº« JavaScript åº“
â”‚   â””â”€â”€ README.md       # ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ web/                # Web é¡¹ç›®
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â””â”€â”€ images/
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ admin/              # ç®¡ç†åå°é¡¹ç›®
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ static/
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â””â”€â”€ media/
â”‚   â””â”€â”€ manifest.json
â”œâ”€â”€ mobile/             # ç§»åŠ¨ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ assets/
â”‚   â””â”€â”€ sw.js
â””â”€â”€ api-docs/           # API æ–‡æ¡£é¡¹ç›®
    â”œâ”€â”€ index.html
    â”œâ”€â”€ swagger.json
    â””â”€â”€ assets/
```

---

## ğŸŒ è®¿é—®è·¯å¾„è§„åˆ™

### URL è®¿é—®æ¨¡å¼

| èµ„æºç±»å‹ | è®¿é—®è·¯å¾„ | ç¤ºä¾‹ |
|---------|---------|------|
| é»˜è®¤é¡µé¢ | `http://domain/` | `http://192.168.1.100/` |
| å…·ä½“é¡¹ç›® | `http://domain/<é¡¹ç›®å>/` | `http://192.168.1.100/web/` |
| å…±äº«èµ„æº | `http://domain/shared/<ç±»å‹>/` | `http://192.168.1.100/shared/tiles/` |
| å¥åº·æ£€æŸ¥ | `http://domain/health` | `http://192.168.1.100/health` |

### å®é™…è®¿é—®ç¤ºä¾‹

```
# é¡¹ç›®è®¿é—®
http://example.com/web/           # Web ä¸»åº”ç”¨
http://example.com/admin/         # ç®¡ç†åå°
http://example.com/mobile/        # ç§»åŠ¨ç«¯åº”ç”¨
http://example.com/docs/          # æ–‡æ¡£ç«™ç‚¹

# å…±äº«èµ„æºè®¿é—®
http://example.com/shared/tiles/0/0/0.png          # åœ°å›¾ç“¦ç‰‡
http://example.com/shared/images/logo.png          # é€šç”¨å›¾ç‰‡
http://example.com/shared/fonts/custom.woff2       # å­—ä½“æ–‡ä»¶
http://example.com/shared/maps/world.geojson       # åœ°å›¾æ•°æ®
http://example.com/shared/libs/jquery.min.js       # å…±äº«åº“

# ç³»ç»Ÿæ¥å£
http://example.com/health                          # å¥åº·æ£€æŸ¥
```

---

## ğŸ”„ å®Œæ•´éƒ¨ç½²æµç¨‹ç¤ºä¾‹

### å¼€å‘ç¯å¢ƒéƒ¨ç½²

```bash
# 1. å¯åŠ¨æœ¬åœ°æœåŠ¡
./nginx-manager.sh start

# 2. éƒ¨ç½²å¼€å‘ç‰ˆæœ¬
./nginx-manager.sh deploy dev /path/to/dev-build

# 3. ä¸Šä¼ å…±äº«èµ„æº
./nginx-manager.sh shared upload /path/to/dev-assets images

# 4. è®¿é—®æµ‹è¯•
curl http://localhost/dev/
```

### æµ‹è¯•ç¯å¢ƒéƒ¨ç½²

```bash
# 1. è¿œç¨‹éƒ¨ç½²æµ‹è¯•ç‰ˆæœ¬
./scripts/remote-deploy.sh test-server.com user test /path/to/test-build

# 2. éªŒè¯éƒ¨ç½²
curl http://test-server.com/test/
```

### ç”Ÿäº§ç¯å¢ƒå¤šé¡¹ç›®éƒ¨ç½²

```bash
# 1. éƒ¨ç½²åŸºç¡€æ¡†æ¶
./scripts/remote-deploy.sh prod-server.com root

# 2. éƒ¨ç½²ä¸»åº”ç”¨
ssh root@prod-server.com 'cd /opt/nginx-template && ./nginx-manager.sh deploy web /tmp/web-dist'

# 3. éƒ¨ç½²ç®¡ç†åå°
ssh root@prod-server.com 'cd /opt/nginx-template && ./nginx-manager.sh deploy admin /tmp/admin-dist'

# 4. éƒ¨ç½²ç§»åŠ¨ç«¯
ssh root@prod-server.com 'cd /opt/nginx-template && ./nginx-manager.sh deploy mobile /tmp/mobile-dist'

# 5. ä¸Šä¼ å…±äº«èµ„æº
ssh root@prod-server.com 'cd /opt/nginx-template && ./nginx-manager.sh shared upload /tmp/tiles tiles'
ssh root@prod-server.com 'cd /opt/nginx-template && ./nginx-manager.sh shared upload /tmp/maps maps'

# 6. éªŒè¯æ‰€æœ‰é¡¹ç›®
curl http://prod-server.com/web/
curl http://prod-server.com/admin/
curl http://prod-server.com/mobile/
curl http://prod-server.com/shared/tiles/0/0/0.png
```

---

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### 1. ç¯å¢ƒåˆ†ç¦»ç­–ç•¥

```bash
# å¼€å‘ç¯å¢ƒ
./nginx-manager.sh deploy dev-web /path/to/dev-build
./nginx-manager.sh deploy dev-admin /path/to/dev-admin

# æµ‹è¯•ç¯å¢ƒ  
./scripts/remote-deploy.sh test-server.com user test-web /path/to/test-build

# ç”Ÿäº§ç¯å¢ƒ
./scripts/remote-deploy.sh prod-server.com user web /path/to/prod-build
```

### 2. ç‰ˆæœ¬ç®¡ç†ç­–ç•¥

```bash
# ä½¿ç”¨ç‰ˆæœ¬å·éƒ¨ç½²
./nginx-manager.sh deploy web-v1.2.0 /path/to/v1.2.0
./nginx-manager.sh deploy web-v1.2.1 /path/to/v1.2.1

# ç‰ˆæœ¬åˆ‡æ¢ï¼ˆé€šè¿‡ nginx é…ç½®ï¼‰
# ä¿®æ”¹ default.conf ä¸­çš„ root è·¯å¾„æŒ‡å‘æ–°ç‰ˆæœ¬
```

### 3. å›æ»šç­–ç•¥

```bash
# è‡ªåŠ¨å¤‡ä»½ï¼ˆè„šæœ¬ä¼šè‡ªåŠ¨å¤‡ä»½æ—§ç‰ˆæœ¬ï¼‰
./nginx-manager.sh deploy web /path/to/new-version

# æ‰‹åŠ¨å›æ»šåˆ°å¤‡ä»½ç‰ˆæœ¬
./nginx-manager.sh backup web
# ç„¶åä» backup/ ç›®å½•æ¢å¤
```

### 4. ç›‘æ§å’Œç»´æŠ¤

```bash
# å¥åº·æ£€æŸ¥
./nginx-manager.sh health

# æŸ¥çœ‹æ‰€æœ‰é¡¹ç›®çŠ¶æ€
./nginx-manager.sh list

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
./nginx-manager.sh status

# æ¸…ç†ç³»ç»Ÿ
./nginx-manager.sh clean
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

1. **ç«¯å£å†²çª**
   ```bash
   # ä¿®æ”¹ .env æ–‡ä»¶ä¸­çš„ç«¯å£
   vim .env
   # NGINX_PORT=8080
   ```

2. **å®¹å™¨å¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   ./nginx-manager.sh logs
   
   # é‡æ–°å¯åŠ¨
   ./nginx-manager.sh restart
   ```

3. **é¡¹ç›®è®¿é—® 404**
   ```bash
   # æ£€æŸ¥é¡¹ç›®æ˜¯å¦æ­£ç¡®éƒ¨ç½²
   ./nginx-manager.sh list
   
   # æµ‹è¯• nginx é…ç½®
   ./nginx-manager.sh test
   ```

4. **è¿œç¨‹éƒ¨ç½²å¤±è´¥**
   ```bash
   # æ£€æŸ¥ SSH è¿æ¥
   ssh user@server 'echo "è¿æ¥æ­£å¸¸"'
   
   # æ£€æŸ¥æœåŠ¡å™¨ç¯å¢ƒ
   ssh user@server 'docker --version && docker-compose --version'
   ```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚éœ€æŠ€æœ¯æ”¯æŒæˆ–é‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š

1. **é¡¹ç›®æ–‡æ¡£**ï¼š`README.md`
2. **Git ä½¿ç”¨æŒ‡å—**ï¼š`GIT_USAGE.md`
3. **éƒ¨ç½²æŒ‡å—**ï¼š`DEPLOYMENT.md`
4. **è„šæœ¬å¸®åŠ©**ï¼š`./nginx-manager.sh help`

---

*æœ€åæ›´æ–°ï¼š$(date +%Y-%m-%d)*
*ç‰ˆæœ¬ï¼š2.0* 