import{_ as F,d as B,r as g,C as v,w as q,e as r,j as E,o as R,h as o,f as a,p as U,n as c,t as j,i as M,Z as u}from"./index-ChCbqBtc.js";import"./lodash-DN9DU0YO.js";import{i as T}from"./index-BD3tVcmV.js";import{e as $}from"./tool-CCETPaDm.js";const L={class:"dialog-footer"},O={__name:"Edit",props:{visible:{type:Boolean,default:!1},tableDataItem:{type:Object,default:()=>({})}},emits:["update:visible","refresh-list"],setup(V,{emit:y}){const{proxy:Z}=B(),i=V,p=y,m=g(!1),f=g(null),e=v({fileName:"",fileSuffix:"",fulltext:""}),N=v({fileName:[{required:!0,message:"请输入文件名称",trigger:"blur"},{min:2,message:"请输入2~10个字符",trigger:"blur"}],fulltext:[{required:!0,message:"请输入正文",trigger:"blur"}]}),h=()=>{var t;(t=f.value)==null||t.resetFields(),e.fileName=""},d=()=>{p("update:visible",!1),h()},w=()=>{d()},S=()=>{const{fileName:t,fileSuffix:l}=$(i.tableDataItem.title);e.fileName=t,e.fileSuffix=l,e.fulltext=i.tableDataItem.fulltext},D=async()=>{try{m.value=!0,T({id:i.tableDataItem.id,title:`${e.fileName}.${e.fileSuffix}`,fulltext:e.fulltext}).then(t=>{const{code:l,msg:n}=t;l===200?(u.success("操作成功！"),d(),p("refresh-list")):u.error(""+n)})}catch{u.error("操作失败，请重试")}finally{setTimeout(()=>{m.value=!1},500)}},_=()=>{f.value&&f.value.validate(t=>{t?D():u.error("请检查表单输入")})};q(()=>i.visible,t=>{t&&S()},{immediate:!0});const I=()=>{_()};return(t,l)=>{const n=r("el-input"),b=r("el-form-item"),C=r("el-form"),x=r("el-button"),k=r("el-dialog");return R(),E(k,{title:"修改",modelValue:i.visible,"onUpdate:modelValue":l[2]||(l[2]=s=>i.visible=s),width:"660px","append-to-body":"","before-close":d},{footer:o(()=>[M("div",L,[a(x,{onClick:w},{default:o(()=>[c("取消")]),_:1}),a(x,{type:"primary",onClick:_,loading:m.value},{default:o(()=>[c(" 确定 ")]),_:1},8,["loading"])])]),default:o(()=>[a(C,{ref_key:"formRef",ref:f,model:e,rules:N,"label-width":"100px",onSubmit:U(I,["prevent"])},{default:o(()=>[a(b,{label:"文件名称",prop:"fileName"},{default:o(()=>[a(n,{modelValue:e.fileName,"onUpdate:modelValue":l[0]||(l[0]=s=>e.fileName=s),placeholder:"请输入文件名称","show-word-limit":""},{append:o(()=>[c("."+j(e.fileSuffix),1)]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"正文",prop:"fulltext"},{default:o(()=>[a(n,{modelValue:e.fulltext,"onUpdate:modelValue":l[1]||(l[1]=s=>e.fulltext=s),placeholder:"请输入正文","show-word-limit":"",type:"textarea",rows:"10"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}},J=F(O,[["__scopeId","data-v-fe35cf90"]]);export{J as default};
