import{d as k,z as A,P as N,w as y,r as m,C as g,a0 as P,e as d,j as M,o as W,h as a,f as n,l as i,n as h,i as X,Z as w}from"./index-ChCbqBtc.js";const Y={class:"dialog-footer"},G={__name:"Upload",props:{visible:{type:Boolean,default:!1},treeSelectedItem:{type:Object,default:()=>({})}},emits:["update:visible","refresh-list"],setup(F,{emit:E}){const{proxy:c}=k();c.useDict("vecotr_partitionOptions"),A(()=>N().getDict("vecotr_partitionOptions"));const u=F,b=E,v=()=>{b("update:visible",!1)};y(()=>u.visible,e=>{});let s=m(!1);function S(){v()}const f=m(null),x=m(null),U=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/pdf","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint","text/plain","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv","application/json"],C=[".doc",".docx",".pdf",".pptx",".ppt",".txt",".xlsx",".xls",".csv",".json"],l=g({dataClass:void 0,uploadFiles:[]});g({vectorPartition:l.dataClass});const j=g({uploadFiles:[{validator:(e,o,t)=>{if(l.uploadFiles.length===0){t(new Error("请上传文件"));return}l.uploadFiles.filter(p=>!U.includes(p.raw.type)).length>0?t(new Error("只能上传 doc、docx、pdf、ppt、pptx、txt、xls、xlsx、csv 和 json 文件")):t()},trigger:["change","blur"]}]});y(()=>l.uploadFiles,e=>{e.length>0&&f.value&&f.value.clearValidate("uploadFiles")});const D=(e,o)=>{l.uploadFiles=o},V=e=>{const t=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/pdf","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","application/csv","application/json"].includes(e.type);let r=15;const p=e.size/(1024*1024)<=r;return t?p?!0:(w.error(`文件大小不能超过 ${r}MB`),s.value=!1,!1):(w.error("只能上传 doc、docx、pdf、ppt、pptx、txt、xls、xlsx、csv 和 json 文件"),s.value=!1,!1)},I=(e,o)=>{l.uploadFiles=o};let L="Bearer "+P(),_=m("");const T=()=>{f.value.validate(e=>{if(e){s.value=!0;const o=new URLSearchParams({foldId:u.treeSelectedItem.id}).toString();_.value=`/api/collectData/upload?${o}`,console.log("uploadUrl",_.value),x.value.submit()}else return w.error("请检查文件上传"),!1})};function z(e,o){if(console.log("handleUploadSuccessres",e),e.code===200)c.$modal.msgSuccess("上传成功"),v(),b("refresh-list");else{const t=e.message?String(e.message):"上传失败";c.$modal.msgError(t)}s.value=!1,x.value.clearFiles()}function B(){c.$modal.msgError("handleUploadError-上传失败"),s.value=!1}return(e,o)=>{const t=d("el-button"),r=d("el-upload"),p=d("el-form-item"),O=d("el-form"),R=d("el-dialog");return W(),M(R,{title:"新增",modelValue:u.visible,"onUpdate:modelValue":o[0]||(o[0]=$=>u.visible=$),width:"660px","append-to-body":"","before-close":v},{footer:a(()=>[X("div",Y,[n(t,{onClick:S},{default:a(()=>[h("取消")]),_:1}),n(t,{type:"primary",onClick:T,loading:i(s)},{default:a(()=>[h(" 确定 ")]),_:1},8,["loading"])])]),default:a(()=>[n(O,{ref_key:"formRef",ref:f,model:i(l),rules:i(j),"label-width":"100px"},{default:a(()=>[n(p,{prop:"uploadFiles",label:"上传文件"},{default:a(()=>[n(r,{ref_key:"uploadRef",ref:x,"file-list":i(l).uploadFiles,action:`${i(_)}`,"auto-upload":!1,accept:C.join(","),"on-change":D,"on-remove":I,"before-upload":V,"on-success":z,"on-error":B,multiple:"",limit:10,style:{width:"100%"},headers:{Authorization:i(L)}},{default:a(()=>[n(t,{type:"primary"},{default:a(()=>[h("选择文件")]),_:1})]),_:1},8,["file-list","action","accept","headers"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}};export{G as default};
