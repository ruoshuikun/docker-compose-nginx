import{d as q,w as T,r as f,C as h,a0 as K,e as p,j as U,o as y,h as o,f as s,l as n,c as X,K as Y,L as Z,n as b,i as G,Z as w}from"./index-ChCbqBtc.js";const H={class:"dialog-footer"},ee={__name:"Upload",props:{visible:{type:Boolean,default:!1},tableDataItem:{type:Object,default:()=>({})}},emits:["update:visible","refresh-list"],setup(S,{emit:V}){const{proxy:u}=q(),{template_type:L}=u.useDict("template_type"),v=S,F=V,_=()=>{F("update:visible",!1)};T(()=>v.visible,e=>{});let i=f(!1);function j(){_()}const m=f(null),x=f(null),C=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/pdf","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint","text/plain","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv","application/json"],k=[".doc",".docx",".pdf",".pptx",".ppt",".txt",".xlsx",".xls",".csv",".json"],t=h({templateType:void 0,uploadFiles:[]});h({vectorPartition:t.templateType});const B=h({templateType:[{required:!0,message:"请选择模板类型",trigger:"change"}],uploadFiles:[{validator:(e,l,a)=>{if(t.uploadFiles.length===0){a(new Error("请上传文件"));return}t.uploadFiles.filter(r=>!C.includes(r.raw.type)).length>0?a(new Error("只能上传 doc、docx、pdf、ppt、pptx、txt、xls、xlsx、csv 和 json 文件")):a()},trigger:["change","blur"]}]});T(()=>t.uploadFiles,e=>{e.length>0&&m.value&&m.value.clearValidate("uploadFiles")});const D=(e,l)=>{t.uploadFiles=l},R=e=>{const a=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/pdf","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","application/csv","application/json"].includes(e.type);let c=15;const r=e.size/(1024*1024)<=c;return a?r?!0:(w.error(`文件大小不能超过 ${c}MB`),i.value=!1,!1):(w.error("只能上传 doc、docx、pdf、ppt、pptx、txt、xls、xlsx、csv 和 json 文件"),i.value=!1,!1)},$=(e,l)=>{t.uploadFiles=l};let z="Bearer "+K(),E=f("");const A=()=>{m.value.validate(e=>{if(e){i.value=!0;const l=new URLSearchParams({templateType:t.templateType||""}).toString();E.value=`/api/server/template/upload?${l}`,x.value.submit()}else return w.error("请检查文件上传"),!1})};function I(e,l){if(console.log("handleUploadSuccessres",e),e.code===200)u.$modal.msgSuccess("上传成功"),_(),F("refresh-list");else{const a=e.message?String(e.message):"上传失败";u.$modal.msgError(a)}i.value=!1,x.value.clearFiles()}function N(){u.$modal.msgError("handleUploadError-上传失败"),i.value=!1}return(e,l)=>{const a=p("el-option"),c=p("el-select"),r=p("el-form-item"),g=p("el-button"),O=p("el-upload"),P=p("el-form"),M=p("el-dialog");return y(),U(M,{title:"新增",modelValue:v.visible,"onUpdate:modelValue":l[1]||(l[1]=d=>v.visible=d),width:"660px","append-to-body":"","before-close":_},{footer:o(()=>[G("div",H,[s(g,{onClick:j},{default:o(()=>[b("取消")]),_:1}),s(g,{type:"primary",onClick:A,loading:n(i)},{default:o(()=>[b(" 确定 ")]),_:1},8,["loading"])])]),default:o(()=>[s(P,{ref_key:"formRef",ref:m,model:n(t),rules:n(B),"label-width":"100px"},{default:o(()=>[s(r,{label:"模板类型",prop:"templateType"},{default:o(()=>[s(c,{modelValue:n(t).templateType,"onUpdate:modelValue":l[0]||(l[0]=d=>n(t).templateType=d)},{default:o(()=>[(y(!0),X(Y,null,Z(n(L),(d,W)=>(y(),U(a,{label:d.label,value:d.value,key:W},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(r,{prop:"uploadFiles",label:"上传文件"},{default:o(()=>[s(O,{ref_key:"uploadRef",ref:x,"file-list":n(t).uploadFiles,action:`${n(E)}`,"auto-upload":!1,accept:k.join(","),"on-change":D,"on-remove":$,"before-upload":R,"on-success":I,"on-error":N,multiple:"",limit:10,style:{width:"100%"},headers:{Authorization:n(z)}},{default:o(()=>[s(g,{type:"primary"},{default:o(()=>[b("选择文件")]),_:1})]),_:1},8,["file-list","action","accept","headers"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}};export{ee as default};
