import{B as He,a as Ge,ag as We,d as Xe,r as m,C as ae,a0 as Ze,J as el,w as ll,e as r,G as oe,c as R,o as u,f as e,h as l,l as o,i as k,D as q,H as y,m as ne,K as z,L as O,j as d,n as g,I as se,k as h,t as ue,aq as tl}from"./index-ChCbqBtc.js";import{e as al,l as ol,f as re,h as nl,i as sl,r as ul,j as rl,k as dl}from"./user-CPx0EaB2.js";import{M as il,g as de}from"./splitpanes-CAxx5xp1.js";const pl={class:"app-container"},ml={class:"head-container"},cl={class:"head-container"},fl={class:"dialog-footer"},_l=k("div",{class:"el-upload__text"},[g("将文件拖到此处，或"),k("em",null,"点击上传")],-1),vl={class:"el-upload__tip text-center"},gl={class:"el-upload__tip"},bl=k("span",null,"仅允许导入xls、xlsx格式文件。",-1),hl={class:"dialog-footer"},yl=He({name:"User"}),Nl=Object.assign(yl,{setup(kl){const ie=Ge(),pe=We(),{proxy:i}=Xe(),{sys_normal_disable:j,sys_user_sex:me}=i.useDict("sys_normal_disable","sys_user_sex"),J=m([]),x=m(!1),B=m(!0),D=m(!0),F=m([]),Q=m(!0),H=m(!0),L=m(0),K=m(""),S=m([]),T=m(""),G=m(void 0),ce=m(void 0),fe=m(void 0),W=m([]),M=m([]),f=ae({open:!1,title:"",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer "+Ze()},url:"http://192.168.137.2:8086/api/system/user/importData"}),N=m([{key:0,label:"用户编号",visible:!0},{key:1,label:"用户名称",visible:!0},{key:2,label:"用户昵称",visible:!0},{key:3,label:"部门",visible:!0},{key:4,label:"手机号码",visible:!0},{key:5,label:"状态",visible:!0},{key:6,label:"创建时间",visible:!0}]),_e=ae({form:{},queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:void 0,deptId:void 0},rules:{userName:[{required:!0,message:"用户名称不能为空",trigger:"blur"},{min:2,max:20,message:"用户名称长度必须介于 2 和 20 之间",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{min:5,max:20,message:"用户密码长度必须介于 5 和 20 之间",trigger:"blur"},{pattern:/^[^<>"'|\\]+$/,message:`不能包含非法字符：< > " ' \\ |`,trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phonenumber:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}}),{queryParams:c,form:s,rules:ve}=el(_e),ge=(n,t)=>n?t.label.indexOf(n)!==-1:!0;ll(T,n=>{i.$refs.deptTreeRef.filter(n)});function C(){B.value=!0,ol(i.addDateRange(c.value,S.value)).then(n=>{B.value=!1,J.value=n.rows,L.value=n.total})}function be(){al().then(n=>{G.value=n.data,ce.value=X(JSON.parse(JSON.stringify(n.data)))})}function X(n){return n.filter(t=>t.disabled?!1:(t.children&&t.children.length&&(t.children=X(t.children)),!0))}function he(n){c.value.deptId=n.id,$()}function $(){c.value.pageNum=1,C()}function ye(){S.value=[],i.resetForm("queryRef"),c.value.deptId=void 0,i.$refs.deptTreeRef.setCurrentKey(null),$()}function Z(n){const t=n.userId||F.value;i.$modal.confirm('是否确认删除用户编号为"'+t+'"的数据项？').then(function(){return nl(t)}).then(()=>{C(),i.$modal.msgSuccess("删除成功")}).catch(()=>{})}function ke(){i.download("system/user/export",{...c.value},`user_${new Date().getTime()}.xlsx`)}function we(n){let t=n.status==="0"?"启用":"停用";i.$modal.confirm('确认要"'+t+'""'+n.userName+'"用户吗?').then(function(){return sl(n.userId,n.status)}).then(()=>{i.$modal.msgSuccess(t+"成功")}).catch(function(){n.status=n.status==="0"?"1":"0"})}function Ve(n){const t=n.userId;ie.push("/system/user-auth/role/"+t)}function xe(n){i.$prompt('请输入"'+n.userName+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:/^.{5,20}$/,inputErrorMessage:"用户密码长度必须介于 5 和 20 之间",inputValidator:t=>{if(/<|>|"|'|\||\\/.test(t))return`不能包含非法字符：< > " ' \\ |`}}).then(({value:t})=>{ul(n.userId,t).then(p=>{i.$modal.msgSuccess("修改成功，新密码是："+t)})}).catch(()=>{})}function Ne(n){F.value=n.map(t=>t.userId),Q.value=n.length!=1,H.value=!n.length}function Ce(){f.title="用户导入",f.open=!0}function Ie(){i.download("system/user/importTemplate",{},`user_template_${new Date().getTime()}.xlsx`)}const Ue=(n,t,p)=>{f.isUploading=!0},Se=(n,t,p)=>{f.open=!1,f.isUploading=!1,i.$refs.uploadRef.handleRemove(t),i.$alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>"+n.msg+"</div>","导入结果",{dangerouslyUseHTMLString:!0}),C()};function $e(){i.$refs.uploadRef.submit()}function E(){s.value={userId:void 0,deptId:void 0,userName:void 0,nickName:void 0,password:void 0,phonenumber:void 0,email:void 0,sex:void 0,status:"0",remark:void 0,postIds:[],roleIds:[]},i.resetForm("userRef")}function Re(){x.value=!1,E()}function De(){E(),re().then(n=>{W.value=n.posts,M.value=n.roles,x.value=!0,K.value="添加用户",s.value.password=fe.value})}function ee(n){E();const t=n.userId||F.value;re(t).then(p=>{s.value=p.data,W.value=p.posts,M.value=p.roles,s.value.postIds=p.postIds,s.value.roleIds=p.roleIds,x.value=!0,K.value="修改用户",s.password=""})}function Te(){tl({userName:s.value.userName}).then(n=>{})}function Pe(){i.$refs.userRef.validate(n=>{n&&(s.value.userId!=null?rl(s.value).then(t=>{i.$modal.msgSuccess("修改成功"),x.value=!1,C()}):dl(s.value).then(t=>{i.$modal.msgSuccess("新增成功"),x.value=!1,Te(),C()}))})}return be(),C(),(n,t)=>{const p=r("el-input"),qe=r("el-tree"),_=r("el-col"),b=r("el-form-item"),A=r("el-option"),Y=r("el-select"),ze=r("el-date-picker"),v=r("el-button"),le=r("el-form"),Oe=r("right-toolbar"),I=r("el-row"),w=r("el-table-column"),Be=r("el-switch"),P=r("el-tooltip"),Fe=r("el-table"),Le=r("pagination"),Ke=r("el-radio"),Me=r("el-radio-group"),te=r("el-dialog"),Ee=r("upload-filled"),Ae=r("el-icon"),Ye=r("el-checkbox"),je=r("el-link"),Je=r("el-upload"),V=oe("hasPermi"),Qe=oe("loading");return u(),R("div",pl,[e(I,{gutter:20},{default:l(()=>[e(o(il),{horizontal:o(pe).device==="mobile",class:"default-theme"},{default:l(()=>[e(o(de),{size:"16"},{default:l(()=>[e(_,null,{default:l(()=>[k("div",ml,[e(p,{modelValue:o(T),"onUpdate:modelValue":t[0]||(t[0]=a=>q(T)?T.value=a:null),placeholder:"请输入部门名称",clearable:"","prefix-icon":"Search",style:{"margin-bottom":"20px"}},null,8,["modelValue"])]),k("div",cl,[e(qe,{data:o(G),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":ge,ref:"deptTreeRef","node-key":"id","highlight-current":"","default-expand-all":"",onNodeClick:he},null,8,["data"])])]),_:1})]),_:1}),e(o(de),{size:"84"},{default:l(()=>[e(_,null,{default:l(()=>[y(e(le,{model:o(c),ref:"queryRef",inline:!0,"label-width":"68px"},{default:l(()=>[e(b,{label:"用户名称",prop:"userName"},{default:l(()=>[e(p,{modelValue:o(c).userName,"onUpdate:modelValue":t[1]||(t[1]=a=>o(c).userName=a),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"},onKeyup:ne($,["enter"])},null,8,["modelValue"])]),_:1}),e(b,{label:"手机号码",prop:"phonenumber"},{default:l(()=>[e(p,{modelValue:o(c).phonenumber,"onUpdate:modelValue":t[2]||(t[2]=a=>o(c).phonenumber=a),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:ne($,["enter"])},null,8,["modelValue"])]),_:1}),e(b,{label:"状态",prop:"status"},{default:l(()=>[e(Y,{modelValue:o(c).status,"onUpdate:modelValue":t[3]||(t[3]=a=>o(c).status=a),placeholder:"用户状态",clearable:"",style:{width:"240px"}},{default:l(()=>[(u(!0),R(z,null,O(o(j),a=>(u(),d(A,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"创建时间",style:{width:"308px"}},{default:l(()=>[e(ze,{modelValue:o(S),"onUpdate:modelValue":t[4]||(t[4]=a=>q(S)?S.value=a:null),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),e(b,null,{default:l(()=>[e(v,{type:"primary",icon:"Search",onClick:$},{default:l(()=>[g("搜索")]),_:1}),e(v,{icon:"Refresh",onClick:ye},{default:l(()=>[g("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[se,o(D)]]),e(I,{gutter:10,class:"mb8"},{default:l(()=>[e(_,{span:1.5},{default:l(()=>[y((u(),d(v,{type:"primary",plain:"",icon:"Plus",onClick:De},{default:l(()=>[g("新增")]),_:1})),[[V,["system:user:add"]]])]),_:1}),e(_,{span:1.5},{default:l(()=>[y((u(),d(v,{type:"success",plain:"",icon:"Edit",disabled:o(Q),onClick:ee},{default:l(()=>[g("修改")]),_:1},8,["disabled"])),[[V,["system:user:edit"]]])]),_:1}),e(_,{span:1.5},{default:l(()=>[y((u(),d(v,{type:"danger",plain:"",icon:"Delete",disabled:o(H),onClick:Z},{default:l(()=>[g("删除")]),_:1},8,["disabled"])),[[V,["system:user:remove"]]])]),_:1}),e(_,{span:1.5},{default:l(()=>[y((u(),d(v,{type:"info",plain:"",icon:"Upload",onClick:Ce},{default:l(()=>[g("导入")]),_:1})),[[V,["system:user:import"]]])]),_:1}),e(_,{span:1.5},{default:l(()=>[y((u(),d(v,{type:"warning",plain:"",icon:"Download",onClick:ke},{default:l(()=>[g("导出")]),_:1})),[[V,["system:user:export"]]])]),_:1}),e(Oe,{showSearch:o(D),"onUpdate:showSearch":t[5]||(t[5]=a=>q(D)?D.value=a:null),onQueryTable:C,columns:o(N)},null,8,["showSearch","columns"])]),_:1}),y((u(),d(Fe,{data:o(J),onSelectionChange:Ne},{default:l(()=>[e(w,{type:"selection",width:"50",align:"center"}),o(N)[0].visible?(u(),d(w,{label:"用户编号",align:"center",key:"userId",prop:"userId"})):h("",!0),o(N)[1].visible?(u(),d(w,{label:"用户名称",align:"center",key:"userName",prop:"userName","show-overflow-tooltip":!0})):h("",!0),o(N)[2].visible?(u(),d(w,{label:"用户昵称",align:"center",key:"nickName",prop:"nickName","show-overflow-tooltip":!0})):h("",!0),o(N)[3].visible?(u(),d(w,{label:"部门",align:"center",key:"deptName",prop:"dept.deptName","show-overflow-tooltip":!0})):h("",!0),o(N)[4].visible?(u(),d(w,{label:"手机号码",align:"center",key:"phonenumber",prop:"phonenumber",width:"120"})):h("",!0),o(N)[5].visible?(u(),d(w,{label:"状态",align:"center",key:"status"},{default:l(a=>[e(Be,{modelValue:a.row.status,"onUpdate:modelValue":U=>a.row.status=U,"active-value":"0","inactive-value":"1",onChange:U=>we(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):h("",!0),o(N)[6].visible?(u(),d(w,{key:6,label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:l(a=>[k("span",null,ue(n.parseTime(a.row.createTime)),1)]),_:1})):h("",!0),e(w,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:l(a=>[a.row.userId!==1?(u(),d(P,{key:0,content:"修改",placement:"top"},{default:l(()=>[y(e(v,{link:"",type:"primary",icon:"Edit",onClick:U=>ee(a.row)},null,8,["onClick"]),[[V,["system:user:edit"]]])]),_:2},1024)):h("",!0),a.row.userId!==1?(u(),d(P,{key:1,content:"删除",placement:"top"},{default:l(()=>[y(e(v,{link:"",type:"primary",icon:"Delete",onClick:U=>Z(a.row)},null,8,["onClick"]),[[V,["system:user:remove"]]])]),_:2},1024)):h("",!0),a.row.userId!==1?(u(),d(P,{key:2,content:"重置密码",placement:"top"},{default:l(()=>[y(e(v,{link:"",type:"primary",icon:"Key",onClick:U=>xe(a.row)},null,8,["onClick"]),[[V,["system:user:resetPwd"]]])]),_:2},1024)):h("",!0),a.row.userId!==1?(u(),d(P,{key:3,content:"分配角色",placement:"top"},{default:l(()=>[y(e(v,{link:"",type:"primary",icon:"CircleCheck",onClick:U=>Ve(a.row)},null,8,["onClick"]),[[V,["system:user:edit"]]])]),_:2},1024)):h("",!0)]),_:1})]),_:1},8,["data"])),[[Qe,o(B)]]),y(e(Le,{total:o(L),page:o(c).pageNum,"onUpdate:page":t[6]||(t[6]=a=>o(c).pageNum=a),limit:o(c).pageSize,"onUpdate:limit":t[7]||(t[7]=a=>o(c).pageSize=a),onPagination:C},null,8,["total","page","limit"]),[[se,o(L)>0]])]),_:1})]),_:1})]),_:1},8,["horizontal"])]),_:1}),e(te,{title:o(K),modelValue:o(x),"onUpdate:modelValue":t[16]||(t[16]=a=>q(x)?x.value=a:null),width:"600px","append-to-body":""},{footer:l(()=>[k("div",fl,[e(v,{type:"primary",onClick:Pe},{default:l(()=>[g("确 定")]),_:1}),e(v,{onClick:Re},{default:l(()=>[g("取 消")]),_:1})])]),default:l(()=>[e(le,{model:o(s),rules:o(ve),ref:"userRef","label-width":"80px"},{default:l(()=>[e(I,null,{default:l(()=>[e(_,{span:12},{default:l(()=>[e(b,{label:"用户昵称",prop:"nickName"},{default:l(()=>[e(p,{modelValue:o(s).nickName,"onUpdate:modelValue":t[8]||(t[8]=a=>o(s).nickName=a),placeholder:"请输入用户昵称",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:l(()=>[e(b,{label:"手机号码",prop:"phonenumber"},{default:l(()=>[e(p,{modelValue:o(s).phonenumber,"onUpdate:modelValue":t[9]||(t[9]=a=>o(s).phonenumber=a),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,null,{default:l(()=>[e(_,{span:12},{default:l(()=>[o(s).userId==null?(u(),d(b,{key:0,label:"用户名称",prop:"userName"},{default:l(()=>[e(p,{modelValue:o(s).userName,"onUpdate:modelValue":t[10]||(t[10]=a=>o(s).userName=a),placeholder:"请输入用户名称",maxlength:"30"},null,8,["modelValue"])]),_:1})):h("",!0)]),_:1}),e(_,{span:12},{default:l(()=>[o(s).userId==null?(u(),d(b,{key:0,label:"用户密码",prop:"password"},{default:l(()=>[e(p,{modelValue:o(s).password,"onUpdate:modelValue":t[11]||(t[11]=a=>o(s).password=a),placeholder:"请输入用户密码",type:"password",maxlength:"20","show-password":""},null,8,["modelValue"])]),_:1})):h("",!0)]),_:1})]),_:1}),e(I,null,{default:l(()=>[e(_,{span:12},{default:l(()=>[e(b,{label:"用户性别"},{default:l(()=>[e(Y,{modelValue:o(s).sex,"onUpdate:modelValue":t[12]||(t[12]=a=>o(s).sex=a),placeholder:"请选择"},{default:l(()=>[(u(!0),R(z,null,O(o(me),a=>(u(),d(A,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:l(()=>[e(b,{label:"状态"},{default:l(()=>[e(Me,{modelValue:o(s).status,"onUpdate:modelValue":t[13]||(t[13]=a=>o(s).status=a)},{default:l(()=>[(u(!0),R(z,null,O(o(j),a=>(u(),d(Ke,{key:a.value,value:a.value},{default:l(()=>[g(ue(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,null,{default:l(()=>[e(_,{span:12},{default:l(()=>[e(b,{label:"角色"},{default:l(()=>[e(Y,{modelValue:o(s).roleIds,"onUpdate:modelValue":t[14]||(t[14]=a=>o(s).roleIds=a),multiple:"",placeholder:"请选择"},{default:l(()=>[(u(!0),R(z,null,O(o(M),a=>(u(),d(A,{key:a.roleId,label:a.roleName,value:a.roleId,disabled:a.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,null,{default:l(()=>[e(_,{span:24},{default:l(()=>[e(b,{label:"备注"},{default:l(()=>[e(p,{modelValue:o(s).remark,"onUpdate:modelValue":t[15]||(t[15]=a=>o(s).remark=a),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(te,{title:o(f).title,modelValue:o(f).open,"onUpdate:modelValue":t[19]||(t[19]=a=>o(f).open=a),width:"400px","append-to-body":""},{footer:l(()=>[k("div",hl,[e(v,{type:"primary",onClick:$e},{default:l(()=>[g("确 定")]),_:1}),e(v,{onClick:t[18]||(t[18]=a=>o(f).open=!1)},{default:l(()=>[g("取 消")]),_:1})])]),default:l(()=>[e(Je,{ref:"uploadRef",limit:1,accept:".xlsx, .xls",headers:o(f).headers,action:o(f).url+"?updateSupport="+o(f).updateSupport,disabled:o(f).isUploading,"on-progress":Ue,"on-success":Se,"auto-upload":!1,drag:""},{tip:l(()=>[k("div",vl,[k("div",gl,[e(Ye,{modelValue:o(f).updateSupport,"onUpdate:modelValue":t[17]||(t[17]=a=>o(f).updateSupport=a)},null,8,["modelValue"]),g("是否更新已经存在的用户数据 ")]),bl,e(je,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:Ie},{default:l(()=>[g("下载模板")]),_:1})])]),default:l(()=>[e(Ae,{class:"el-icon--upload"},{default:l(()=>[e(Ee)]),_:1}),_l]),_:1},8,["headers","action","disabled"])]),_:1},8,["title","modelValue"])])}}});export{Nl as default};
