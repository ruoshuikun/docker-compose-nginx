import{_ as Ue,B as $e,a as Le,ag as Ee,d as ze,r as i,w as qe,e as v,G as Be,c as L,o as s,f as n,i as R,h as a,l as o,D as h,p as E,t as J,j as m,k as W,n as u,H as _,m as X,K,L as F,I as Ae,Z as Y}from"./index-ChCbqBtc.js";import{b as Ke,c as Fe,d as je,e as Oe,R as Pe,f as Me,g as Qe}from"./index-BD3tVcmV.js";import{M as Ge,g as ee}from"./splitpanes-CAxx5xp1.js";import He from"./AddEditFolder-gUUXM6UO.js";import Ze from"./Upload-C_YG8yKm.js";import Je from"./CreateKnowledgeBase-Co1kfmgv.js";import We from"./AddKnowledgeBase-ZzE5nEqf.js";import{c as Xe}from"./tool-CCETPaDm.js";import"./lodash-DN9DU0YO.js";const Ye={class:"app-container"},et={class:"head-container"},tt={class:"head-container"},lt={class:"custom-tree-node"},at=["onClick"],ot={class:"flex flex-col justify-end items-start custom-affix"},nt=$e({name:"Document"}),it=Object.assign(nt,{setup(dt){Le();const te=Ee(),{proxy:b}=ze(),{import_knowledge_base:le,sync_state:ae}=b.useDict("import_knowledge_base","sync_state");i(!1);const j=i(!0),T=i(!0);i([]),i(!0),i(!0);const oe=i([]),O=i(void 0),U=i(""),ne=i([{prop:"title",label:"文件名称",width:300,align:"left",fixed:"left"},{prop:"filetype",label:"文件类型",width:100},{prop:"sizeofraw",label:"文件大小",type:"custom",width:100},{prop:"uploaduser",label:"上传人",width:100},{prop:"word",label:"导入知识库状态",width:150},{prop:"createTime",label:"上传时间",width:100},{prop:"fulltext",label:"正文",type:"longText",width:250},{prop:"updateTime",label:"关系/图/向量同步状态",width:200},{prop:"",label:"操作",type:"operation",width:230,align:"right",fixed:"right"}]),P=i([]),D=i({total:0,pageNum:1,pageSize:10}),c=i({treeId:1});function V(){j.value=!0;const e={current:D.value.pageNum,pageSize:D.value.pageSize,foldid:c.value.treeId};Ke(e).then(t=>{j.value=!1,t.data.records.map(r=>{r.loadingView=!1}),P.value=t.data.records,D.value.total=Number(t.data.total)})}V();let M=i([]);const ie=e=>{console.log("tableSelectionChange",e),M.value=e},de=(e,t)=>{},re=(e,t,r)=>{},se=(e,t,r)=>{},ue=(e,t,r)=>{},ce=(e,t,r,d)=>{},pe=(e,t,r,d)=>{je({id:e.data.id,parentId:t.data.id}).then(w=>{const{code:p,msg:g}=w;p===200?(Y.success(g),$()):Y.error(g||"操作失败")})},me=(e,t,r)=>t.data.label==="Level two 3-1"?r!=="inner":!0,fe=e=>!e.data.label.includes("根目录"),Q=i(null);qe(U,e=>{b.$refs.treeRef.filter(e)});const ve=(e,t)=>e?t.label.includes(e):!0;let y=i(void 0);function $(){Fe().then(e=>{O.value=e.data,Array.isArray(e.data)&&e.data.length&&(y.value=e.data[0])})}$();let x=i(!1),z=i("新增");function be(e){z.value="新增",y.value=e,x.value=!0}function ge(e){z.value="修改",y.value=e,x.value=!0}function he(e){b.$modal.confirm(`是否确认删除目录名称为${e.label}的数据项?`).then(function(){return Oe(e.id)}).then(()=>{$(),b.$modal.msgSuccess("删除成功")}).catch(()=>{})}i({});function _e(e){c.value.treeId=e.id,y.value=e,N()}function ye(e){}let G=i([]);const ke=(e,t,r)=>{console.log(e,t,r),G.value=we()},we=()=>{var e;return(e=Q.value)==null?void 0:e.getCheckedNodes(!1,!1)};function N(){c.value.pageNum=1,V()}function Ce(){oe.value=[],b.resetForm("queryRef"),c.value.deptId=void 0,b.$refs.deptTreeRef.setCurrentKey(null),N()}function Se(e){Pe({fileId:e.fileid}).then(t=>{const r=new Blob([t],{type:t.type||"application/octet-stream"});let d=e.title;const w=window.URL.createObjectURL(r),p=document.createElement("a");p.href=w,p.download=d,p.style.display="none",document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(w),document.body.removeChild(p)})}function De(e){e.loadingView=!0,Me({file_path:e.url}).then(t=>{const{code:r,data:{pdf_url:d},msg:w}=t;r===200?window.open(d,"_blank"):b.$modal.msgError(""+w)}).finally(()=>{setTimeout(()=>{e.loadingView=!1},500)})}function rt(e){}function H(e){k.value=!0}function xe(e){console.log("handleSync",e)}function Ne(e){console.log("row",e),b.$modal.confirm(`是否确认删除用户编号为${e.title}的数据项？`).then(function(){return Qe(e.id)}).then(()=>{V(),b.$modal.msgSuccess("删除成功")}).catch(()=>{})}let I=i(!1);function Re(){I.value=!0}let S=i(!1),k=i(!1);return(e,t)=>{const r=v("el-input"),d=v("el-button"),w=v("el-tree"),p=v("el-col"),g=v("el-form-item"),q=v("el-option"),B=v("el-select"),Ve=v("el-form"),Ie=v("right-toolbar"),Z=v("el-row"),Te=v("Table"),C=Be("hasPermi");return s(),L("div",Ye,[n(Z,{gutter:20},{default:a(()=>[n(o(Ge),{horizontal:o(te).device==="mobile",class:"default-theme"},{default:a(()=>[n(o(ee),{size:"24"},{default:a(()=>[n(p,null,{default:a(()=>[R("div",et,[n(r,{modelValue:o(U),"onUpdate:modelValue":t[0]||(t[0]=l=>h(U)?U.value=l:null),placeholder:"请输入目录名称",clearable:"","prefix-icon":"Search",class:"mb-d"},null,8,["modelValue"])]),R("div",tt,[n(w,{ref_key:"treeRef",ref:Q,style:{"max-width":"400px"},"allow-drop":me,"allow-drag":fe,data:o(O),draggable:"","default-expand-all":"","node-key":"id","show-checkbox":"","filter-node-method":ve,onNodeDragStart:de,onNodeDragEnter:re,onNodeDragLeave:se,onNodeDragOver:ue,onNodeDragEnd:ce,onNodeDrop:pe,onNodeClick:ye,onCheckChange:ke},{default:a(({node:l,data:f})=>[R("div",lt,[R("span",{onClick:E(A=>_e(f),["stop"])},J(l.label),9,at),R("div",null,[n(d,{type:"primary",link:"",onClick:E(A=>be(f),["stop"])},{default:a(()=>[u(" 添加 ")]),_:2},1032,["onClick"]),f.id!==1?(s(),m(d,{key:0,style:{"margin-left":"4px"},type:"primary",link:"",onClick:E(A=>ge(f),["stop"])},{default:a(()=>[u(" 修改 ")]),_:2},1032,["onClick"])):W("",!0),f.id!==1?(s(),m(d,{key:1,style:{"margin-left":"4px"},type:"danger",link:"",onClick:E(A=>he(f),["stop"])},{default:a(()=>[u(" 删除 ")]),_:2},1032,["onClick"])):W("",!0)])])]),_:1},8,["data"])])]),_:1})]),_:1}),n(o(ee),{size:"76"},{default:a(()=>[n(p,null,{default:a(()=>[_(n(Ve,{model:o(c),ref:"queryRef",inline:!0,"label-width":"115px"},{default:a(()=>[n(g,{label:"文件名称",prop:"userName"},{default:a(()=>[n(r,{modelValue:o(c).userName,"onUpdate:modelValue":t[1]||(t[1]=l=>o(c).userName=l),placeholder:"请输入文件名称",clearable:"",style:{width:"240px"},onKeyup:X(N,["enter"])},null,8,["modelValue"])]),_:1}),n(g,{label:"正文",prop:"phonenumber"},{default:a(()=>[n(r,{modelValue:o(c).phonenumber,"onUpdate:modelValue":t[2]||(t[2]=l=>o(c).phonenumber=l),placeholder:"请输入关键词",clearable:"",style:{width:"240px"},onKeyup:X(N,["enter"])},null,8,["modelValue"])]),_:1}),n(g,{label:"上传人",prop:"status"},{default:a(()=>[n(B,{modelValue:o(c).status,"onUpdate:modelValue":t[3]||(t[3]=l=>o(c).status=l),placeholder:"请选择",clearable:"",style:{width:"240px"}},{default:a(()=>[(s(!0),L(K,null,F(e.sys_normal_disable,l=>(s(),m(q,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(g,{label:"导入知识库状态",prop:"status"},{default:a(()=>[n(B,{modelValue:o(c).status,"onUpdate:modelValue":t[4]||(t[4]=l=>o(c).status=l),placeholder:"请选择",clearable:"",style:{width:"240px"}},{default:a(()=>[(s(!0),L(K,null,F(o(le),l=>(s(),m(q,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(g,{label:"同步向量库状态",prop:"status"},{default:a(()=>[n(B,{modelValue:o(c).status,"onUpdate:modelValue":t[5]||(t[5]=l=>o(c).status=l),placeholder:"请选择",clearable:"",style:{width:"240px"}},{default:a(()=>[(s(!0),L(K,null,F(o(ae),l=>(s(),m(q,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(g,null,{default:a(()=>[n(d,{type:"primary",icon:"Search",onClick:N},{default:a(()=>[u("搜索")]),_:1}),n(d,{icon:"Refresh",onClick:Ce},{default:a(()=>[u("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[Ae,o(T)]]),n(Z,{gutter:10,class:"mb8"},{default:a(()=>[n(p,{span:1.5},{default:a(()=>[_((s(),m(d,{type:"primary",plain:"",icon:"Plus",onClick:Re},{default:a(()=>[u("新增 ")]),_:1})),[[C,["document:list:add"]]])]),_:1}),n(p,{span:1.5},{default:a(()=>[_((s(),m(d,{type:"info",plain:"",icon:"Upload",onClick:H},{default:a(()=>[u(" 抽取实体及关系 ")]),_:1})),[[C,["system:user:import"]]])]),_:1}),n(Ie,{showSearch:o(T),"onUpdate:showSearch":t[6]||(t[6]=l=>h(T)?T.value=l:null),onQueryTable:V},null,8,["showSearch"])]),_:1}),n(Te,{paginationData:o(D),"onUpdate:paginationData":t[7]||(t[7]=l=>h(D)?D.value=l:null),tableColumn:o(ne),tableData:o(P),showIndex:!0,showSelection:!0,onSelectionChange:ie,onGetTableData:V},{sizeofraw:a(({row:l})=>[u(J(o(Xe)(l.sizeofraw).formatted),1)]),operation:a(({row:l})=>[_((s(),m(d,{link:"",type:"primary",icon:"Download",onClick:f=>Se(l)},{default:a(()=>[u("下载 ")]),_:2},1032,["onClick"])),[[C,["document:list:download"]]]),_((s(),m(d,{link:"",type:"primary",icon:"View",onClick:f=>De(l),loading:l.loadingView},{default:a(()=>[u("预览 ")]),_:2},1032,["onClick","loading"])),[[C,["document:list:view"]]]),_((s(),m(d,{link:"",type:"primary",icon:"Edit",onClick:f=>void 0},{default:a(()=>[u("修改 ")]),_:2},1032,["onClick"])),[[C,["document:list:edit"]]]),_((s(),m(d,{link:"",type:"primary",icon:"Right",onClick:f=>H(l)},{default:a(()=>[u("导入 ")]),_:2},1032,["onClick"])),[[C,["document:list:import"]]]),_((s(),m(d,{link:"",type:"primary",icon:"RefreshRight",onClick:f=>xe(l)},{default:a(()=>[u("同步 ")]),_:2},1032,["onClick"])),[[C,["document:list:sync"]]]),_((s(),m(d,{link:"",type:"danger",icon:"Delete",onClick:f=>Ne(l)},{default:a(()=>[u(" 删除 ")]),_:2},1032,["onClick"])),[[C,["document:list:remove"]]])]),_:1},8,["paginationData","tableColumn","tableData"])]),_:1})]),_:1})]),_:1},8,["horizontal"])]),_:1}),R("div",ot,[n(d,{type:"primary",plain:"",onClick:t[8]||(t[8]=l=>h(S)?S.value=!0:S=!0)},{default:a(()=>[u(" 新建知识库 ")]),_:1}),n(d,{class:"mt-m",type:"success",plain:"",onClick:t[9]||(t[9]=l=>h(k)?k.value=!0:k=!0)},{default:a(()=>[u(" 添加到知识库 ")]),_:1})]),n(He,{visible:o(x),"onUpdate:visible":t[10]||(t[10]=l=>h(x)?x.value=l:x=l),title:o(z),treeSelectedItem:o(y),onRefreshList:$},null,8,["visible","title","treeSelectedItem"]),n(Ze,{visible:o(I),"onUpdate:visible":t[11]||(t[11]=l=>h(I)?I.value=l:I=l),treeSelectedItem:o(y),onRefreshList:N},null,8,["visible","treeSelectedItem"]),n(Je,{visible:o(S),"onUpdate:visible":t[12]||(t[12]=l=>h(S)?S.value=l:S=l),treeSelectedItem:o(y),onRefreshList:t[13]||(t[13]=()=>{})},null,8,["visible","treeSelectedItem"]),n(We,{visible:o(k),"onUpdate:visible":t[14]||(t[14]=l=>h(k)?k.value=l:k=l),treeSelectedItem:o(y),treeSelectedCheckbox:o(G),tableSelectedCheckbox:o(M),onRefreshList:t[15]||(t[15]=()=>{})},null,8,["visible","treeSelectedItem","treeSelectedCheckbox","tableSelectedCheckbox"])])}}}),ht=Ue(it,[["__scopeId","data-v-9fe47117"]]);export{ht as default};
