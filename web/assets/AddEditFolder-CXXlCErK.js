import{_ as Y,d as j,r as h,C as y,z as x,w as H,e as r,j as T,o as U,h as l,f as n,p as $,i as z,n as D,Z as i,am as O,an as Z}from"./index-ChCbqBtc.js";import{l as G}from"./lodash-DN9DU0YO.js";import{h as J,d as K}from"./index-BD3tVcmV.js";const L={class:"dialog-footer"},P={__name:"AddEditFolder",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"",validator:m=>["新增","修改"].includes(m)},treeSelectedItem:{type:Object,default:()=>({})}},emits:["update:visible","refresh-list"],setup(m,{emit:w}){const{proxy:Q}=j(),t=m,_=w,c=h(!1),d=h(null),o=y({name:""}),A=y({name:[{required:!0,message:"请输入目录名称",trigger:"blur"},{min:2,max:10,message:"请输入2~10个字符",trigger:"blur"}]}),M=x(()=>t.title==="修改"),b=x(()=>t.title==="新增"),S=()=>{var e;(e=d.value)==null||e.resetFields(),o.name=""},u=()=>{_("update:visible",!1),S()},V=()=>{u()},I=()=>{var e;M.value&&((e=t.treeSelectedItem)!=null&&e.label)?o.name=G.cloneDeep(t.treeSelectedItem.label):o.name=""},C=e=>{O({name:`${e}_${Z().format("YYYYMMDDHHmmss")}`}).then(s=>{const{code:a,msg:p}=s;a===200||i.error(""+p)})},R=()=>b.value?{folderName:o.name,parentId:t.treeSelectedItem.id}:{folderName:o.name,id:t.treeSelectedItem.id},q=()=>b.value?J:K,E=e=>{const{code:s,msg:a}=e;s===200?(C(o.name),i.success(a),u(),_("refresh-list")):i.error(a||"操作失败")},F=async()=>{try{c.value=!0;const e=R(),a=await q()(e);E(a)}catch(e){console.error("提交失败:",e),i.error("操作失败，请重试")}finally{setTimeout(()=>{c.value=!1},300)}},g=()=>{d.value&&d.value.validate(e=>{e?F():i.error("请检查表单输入")})};H(()=>t.visible,e=>{e&&I()},{immediate:!0});const k=()=>{g()};return(e,s)=>{const a=r("el-input"),p=r("el-form-item"),N=r("el-form"),v=r("el-button"),B=r("el-dialog");return U(),T(B,{title:t.title,modelValue:t.visible,"onUpdate:modelValue":s[1]||(s[1]=f=>t.visible=f),width:"660px","append-to-body":"","before-close":u},{footer:l(()=>[z("div",L,[n(v,{onClick:V},{default:l(()=>[D("取消")]),_:1}),n(v,{type:"primary",onClick:g,loading:c.value},{default:l(()=>[D(" 确定 ")]),_:1},8,["loading"])])]),default:l(()=>[n(N,{ref_key:"formRef",ref:d,model:o,rules:A,"label-width":"100px",onSubmit:$(k,["prevent"])},{default:l(()=>[n(p,{label:"目录名称",prop:"name"},{default:l(()=>[n(a,{modelValue:o.name,"onUpdate:modelValue":s[0]||(s[0]=f=>o.name=f),placeholder:"请输入目录名称",maxlength:"10","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}},te=Y(P,[["__scopeId","data-v-230192ab"]]);export{te as default};
