import{d as I,w as b,r as m,C as _,a0 as N,e as d,j as O,o as P,h as a,f as n,l as i,n as g,i as M,Z as h}from"./index-ChCbqBtc.js";const W={class:"dialog-footer"},Z={__name:"Upload",props:{visible:{type:Boolean,default:!1},tableDataItem:{type:Object,default:()=>({})}},emits:["update:visible","refresh-list"],setup(F,{emit:E}){const{proxy:c}=I(),{template_type:q}=c.useDict("template_type"),f=F,y=E,v=()=>{y("update:visible",!1)};b(()=>f.visible,e=>{});let s=m(!1);function T(){v()}const u=m(null),x=m(null),U=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/pdf","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-powerpoint","text/plain","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv","application/json"],S=[".doc",".docx",".pdf",".pptx",".ppt",".txt",".xlsx",".xls",".csv",".json"],l=_({templateType:void 0,uploadFiles:[]});_({vectorPartition:l.templateType});const j=_({templateType:[{required:!0,message:"请选择模板类型",trigger:"change"}],uploadFiles:[{validator:(e,o,t)=>{if(l.uploadFiles.length===0){t(new Error("请上传文件"));return}l.uploadFiles.filter(r=>!U.includes(r.raw.type)).length>0?t(new Error("只能上传 doc、docx、pdf、ppt、pptx、txt、xls、xlsx、csv 和 json 文件")):t()},trigger:["change","blur"]}]});b(()=>l.uploadFiles,e=>{e.length>0&&u.value&&u.value.clearValidate("uploadFiles")});const C=(e,o)=>{l.uploadFiles=o},V=e=>{const t=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/pdf","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","application/csv","application/json"].includes(e.type);let p=15;const r=e.size/(1024*1024)<=p;return t?r?!0:(h.error(`文件大小不能超过 ${p}MB`),s.value=!1,!1):(h.error("只能上传 doc、docx、pdf、ppt、pptx、txt、xls、xlsx、csv 和 json 文件"),s.value=!1,!1)},L=(e,o)=>{l.uploadFiles=o};let B="Bearer "+N(),w=m("");const D=()=>{u.value.validate(e=>{if(e){s.value=!0;const o=new URLSearchParams({templateType:l.templateType||""}).toString();w.value=`/api/server/template/upload?${o}`,x.value.submit()}else return h.error("请检查文件上传"),!1})};function R(e,o){if(console.log("handleUploadSuccessres",e),e.code===200)c.$modal.msgSuccess("上传成功"),v(),y("refresh-list");else{const t=e.message?String(e.message):"上传失败";c.$modal.msgError(t)}s.value=!1,x.value.clearFiles()}function $(){c.$modal.msgError("handleUploadError-上传失败"),s.value=!1}return(e,o)=>{const t=d("el-button"),p=d("el-upload"),r=d("el-form-item"),k=d("el-form"),z=d("el-dialog");return P(),O(z,{title:"新增",modelValue:f.visible,"onUpdate:modelValue":o[0]||(o[0]=A=>f.visible=A),width:"660px","append-to-body":"","before-close":v},{footer:a(()=>[M("div",W,[n(t,{onClick:T},{default:a(()=>[g("取消")]),_:1}),n(t,{type:"primary",onClick:D,loading:i(s)},{default:a(()=>[g(" 抽取 ")]),_:1},8,["loading"])])]),default:a(()=>[n(k,{ref_key:"formRef",ref:u,model:i(l),rules:i(j),"label-width":"100px"},{default:a(()=>[n(r,{prop:"uploadFiles",label:"上传文件"},{default:a(()=>[n(p,{ref_key:"uploadRef",ref:x,"file-list":i(l).uploadFiles,action:`${i(w)}`,"auto-upload":!1,accept:S.join(","),"on-change":C,"on-remove":L,"before-upload":V,"on-success":R,"on-error":$,multiple:"",limit:10,style:{width:"100%"},headers:{Authorization:i(B)}},{default:a(()=>[n(t,{type:"primary"},{default:a(()=>[g("选择文件")]),_:1})]),_:1},8,["file-list","action","accept","headers"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}};export{Z as default};
